<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Binance Stop Limit Profit Calculator</title>
  <!-- <style>
    /* Base styles */
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 500px;
      margin: auto;
      background-color: #f7f7f7;
    }
    h1 {
      text-align: center;
      font-size: 1.8em;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      font-size: 1em;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      box-sizing: border-box;
      font-size: 1em;
    }
    /* Radio group styling for horizontal alignment */
    .radio-group {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-top: 5px;
    }
    .radio-group label {
      font-weight: normal;
      margin-right: 5px;
    }
    button {
      margin-top: 20px;
      padding: 10px;
      width: 100%;
      font-size: 1em;
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    /* Responsive result text styling */
    .result {
      margin-top: 20px;
      padding: 15px;
      background-color: #e9ecef;
      border-radius: 5px;
      white-space: pre-line;
      /* Base font size */
      font-size: 1em;
    }
    /* Smaller screens */
    @media only screen and (max-width: 480px) {
      .result {
        font-size: 0.8em;
      }
      h1 {
        font-size: 1.5em;
      }
      label, input, select, button {
        font-size: 0.9em;
      }
    }
    /* Larger screens */
    @media only screen and (min-width: 1024px) {
      .result {
        font-size: 1.2em;
      }
      h1 {
        font-size: 2em;
      }
      label, input, select, button {
        font-size: 1.1em;
      }
    }
  </style> -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>

<body>

  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="row justify-content-center">
          <div class="col-10 col-md-8 col-lg-6">
            <div class="text-center my-5">
              <h1>Stop Limit Profit Calculator</h1>
            </div>
          </div>
        </div>
    
    
    
        <div class="row justify-content-center">
          <div class="col-10 col-md-8 col-lg-6">
            <!-- Search field for coins -->
            <label for="coinSearch" class="form-label">Search Coin:</label>
            <input type="text" class="form-control" id="coinSearch" placeholder="Type to search coin..." />
          </div>
        </div>
    
    
        <div class="row justify-content-center">
          <div class="col-10 col-md-8 col-lg-6">
            <!-- Coin Selector -->
            <label for="coinSelector" class="form-label">Select Coin (USDT Pair):</label>
            <select id="coinSelector" class="form-select">
              <option value="">Loading coins...</option>
            </select>
          </div>
        </div>
    
        <div class="row justify-content-center">
          <div class="col-10 col-md-8 col-lg-6">
            <!-- Investment amount -->
            <label for="investment" class="form-label">Investment Amount:</label>
            <input class="form-control" type="number" id="investment" placeholder="Enter amount" />
          </div>
        </div>
    
    
    
    
        <div class="row justify-content-center">
          <div class="col-10 col-md-8 col-lg-6">
            <!-- Investment type: USDT or number of Coins -->
            <label for="investmentType" class="form-label">Investment Type:</label>
            <select id="investmentType" class="form-select">
              <option value="USDT">USDT (investment value)</option>
              <option value="Coin">Coin (number of coins)</option>
            </select>
          </div>
        </div>
    
    
    
        <div class="row justify-content-center my-3">
          <div class="col-10 col-md-8 col-lg-6">
            <!-- Price Source selection -->
            <label class="form-label">Entry Price Source:</label>
            <div class="radio-group">
    
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="priceSource" id="priceSourceMarket" value="market"
                  checked>
                <label class="form-check-label" for="priceSourceMarket">
                  Market Price
                </label>
              </div>
    
    
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="priceSource" id="priceSourceManual" value="manual">
                <label class="form-check-label" for="priceSourceManual">
                  Manual Entry
                </label>
              </div>
    
    
            </div>
          </div>
        </div>
    
    
        <div class="row justify-content-center">
          <div class="col-10 col-md-8 col-lg-6">
            <!-- Entry price (auto-filled if Market Price is selected) -->
            <label for="entryPrice" class="form-label">Entry Price (USDT per coin):</label>
            <input class="form-control" type="number" id="entryPrice" placeholder="Enter your entry price" step="0.01"
              disabled />
          </div>
        </div>
    
    
        <div class="row justify-content-center">
          <div class="col-10 col-md-8 col-lg-6">
            <!-- Stop-limit trigger price -->
            <label for="triggerPrice" class="form-label">Stop Limit Trigger Price (USDT per coin):</label>
            <input class="form-control" type="number" class="form-control" id="triggerPrice"
              placeholder="Enter your trigger price" step="0.01" />
    
          </div>
        </div>
    
    
        <div class="row justify-content-center text-center my-2">
          <div class="col-10 col-md-8 col-lg-6">
            <!-- Calculate button -->
            <button class="btn btn-primary btn-lg" onclick="calculateProfit()">Calculate Profit</button>
          </div>
        </div>
    
    
        <!-- Result display -->
        <div class="row justify-content-center my-2">
          <div class="col-10 col-md-8 col-lg-6">
            <div class="mt-3" id="result"></div>
          </div>
        </div>
      </div>
    
      </div>
    </div>
    
  <script>
    // Global objects to store coin prices and the full coin list.
    let coinPrices = {};
    let coinsList = []; // This will be loaded only once on the first fetch.

    // Function to update the coin selector based on the current coinsList and search filter.
    function updateCoinSelector() {
      const coinSelect = document.getElementById('coinSelector');
      const searchValue = document.getElementById('coinSearch').value.toLowerCase().trim();
      const previousSelection = coinSelect.value; // Preserve user's selection.
      coinSelect.innerHTML = ""; // Clear existing options.

      // Filter coinsList based on search query (by symbol or coin name).
      const filteredCoins = coinsList.filter(coin =>
        coin.symbol.toLowerCase().includes(searchValue) ||
        coin.coinName.toLowerCase().includes(searchValue)
      );

      // Populate the dropdown with the filtered coins.
      filteredCoins.forEach(coin => {
        const option = document.createElement('option');
        option.value = coin.symbol;
        option.text = `${coin.coinName} (Current: ${coin.price.toFixed(2)} USDT)`;
        coinSelect.appendChild(option);
      });

      // Restore previous selection if it still exists.
      if (previousSelection) {
        coinSelect.value = previousSelection;
      }
      updateEntryPriceState();
    }

    // Function to update the entry price field state based on the selected price source.
    function updateEntryPriceState() {
      const priceSource = document.querySelector('input[name="priceSource"]:checked').value;
      const entryPriceInput = document.getElementById('entryPrice');
      const coinSelector = document.getElementById('coinSelector');
      const selectedSymbol = coinSelector.value;

      if (priceSource === "market") {
        entryPriceInput.disabled = true;
        if (selectedSymbol && coinPrices[selectedSymbol]) {
          entryPriceInput.value = coinPrices[selectedSymbol].toFixed(2);
        } else {
          entryPriceInput.value = "";
        }
      } else {
        entryPriceInput.disabled = false;
      }
    }

    // Function to fetch coin prices from Binance API.
    // On the first load, the coinsList and dropdown are fully initialized.
    // On subsequent fetches, only the prices are updated without repopulating the dropdown.
    function fetchCoinPrices() {
      fetch('https://api.binance.com/api/v3/ticker/price')
        .then(response => response.json())
        .then(data => {
          // Filter to include only USDT pairs and sort alphabetically.
          const usdtPairs = data.filter(item => item.symbol.endsWith('USDT'));
          usdtPairs.sort((a, b) => a.symbol.localeCompare(b.symbol));

          // Update the coinPrices dictionary.
          usdtPairs.forEach(item => {
            coinPrices[item.symbol] = parseFloat(item.price);
          });

          // If coinsList is empty, initialize it and populate the dropdown.
          if (coinsList.length === 0) {
            coinsList = usdtPairs.map(item => {
              return {
                symbol: item.symbol,
                coinName: item.symbol.slice(0, -4),
                price: parseFloat(item.price)
              };
            });
            updateCoinSelector();
          } else {
            // Update the price in the coinsList array.
            coinsList.forEach(coin => {
              if (coinPrices[coin.symbol]) {
                coin.price = coinPrices[coin.symbol];
              }
            });
            // Check the search field. If empty, update only the option texts to preserve selection.
            const searchValue = document.getElementById('coinSearch').value.trim();
            const coinSelect = document.getElementById('coinSelector');
            if (searchValue === "") {
              // Update the text of each existing option.
              for (let i = 0; i < coinSelect.options.length; i++) {
                let option = coinSelect.options[i];
                let symbol = option.value;
                if (coinPrices[symbol]) {
                  option.text = symbol.slice(0, -4) + ' (Current: ' + coinPrices[symbol].toFixed(2) + ' USDT)';
                }
              }
            } else {
              // If the user is using the search field, reapply the filter.
              updateCoinSelector();
            }
          }
          updateEntryPriceState();
        })
        .catch(error => {
          console.error("Error fetching coin data: ", error);
          document.getElementById('coinSelector').innerHTML = '<option value="">Error loading coins</option>';
        });
    }

    // Event listeners.
    document.getElementById('priceSourceMarket').addEventListener('change', updateEntryPriceState);
    document.getElementById('priceSourceManual').addEventListener('change', updateEntryPriceState);
    document.getElementById('coinSelector').addEventListener('change', updateEntryPriceState);
    document.getElementById('coinSearch').addEventListener('input', updateCoinSelector);

    // Fetch coin prices every 5 seconds.
    setInterval(fetchCoinPrices, 5000);
    // Also fetch coin prices when the page loads.
    document.addEventListener('DOMContentLoaded', fetchCoinPrices);

    // Function to calculate profit.
    function calculateProfit() {
      const investment = parseFloat(document.getElementById('investment').value);
      const investmentType = document.getElementById('investmentType').value;
      const entryPrice = parseFloat(document.getElementById('entryPrice').value);
      const triggerPrice = parseFloat(document.getElementById('triggerPrice').value);

      // Validate inputs.
      if (isNaN(investment) || isNaN(entryPrice) || isNaN(triggerPrice)) {
        document.getElementById('result').innerText = "Please enter valid numbers for all fields.";
        return;
      }
      if (entryPrice <= 0) {
        document.getElementById('result').innerText = "Entry price must be greater than zero.";
        return;
      }

      let quantity, costBasis;
      if (investmentType === "USDT") {
        quantity = investment / entryPrice;
        costBasis = investment;
      } else {
        quantity = investment;
        costBasis = quantity * entryPrice;
      }

      const profitPerCoin = triggerPrice - entryPrice;
      const profitUSDT = quantity * profitPerCoin;
      const profitPercent = (profitUSDT / costBasis) * 100;

      let resultText = "<div class='fw-bolder my-2'>";
      resultText += "Coin: " + document.getElementById('coinSelector').selectedOptions[0].text + "\n";
      resultText += "</div> <div class='fw-bolder my-2'>Quantity: " + quantity.toFixed(6) + " coins\n";

      let profitTextColor = "";
      if (profitUSDT < 0) {
        profitTextColor = "text-danger";
      }
      else {
        profitTextColor = "text-success";

      }
      resultText += `</div> <div class='fw-bolder my-2 ${profitTextColor}'>Profit: ${profitUSDT.toFixed(2)} USDT\n`;
      resultText += "</div> <div class='fw-bolder'><Profit Percentage: " + profitPercent.toFixed(2) + "% </div>";

      document.getElementById('result').innerHTML = resultText;
    }
  </script>
</body>

</html>